---
tags:
  - AZ-700
  - azure/networking
  - domain/connectivity
  - vpn-gateway
  - site-to-site
  - ipsec
  - ikev2
  - bgp
  - active-active
  - high-availability
  - gatewaysubnet
  - local-network-gateway
aliases:
  - VPN Gateway
  - S2S VPN
  - Site-to-Site VPN
created: 2025-01-01
updated: 2026-02-07
---

# Azure VPN Gateway - AZ-700 Study Notes

> [!info] Related Notes
> - [[Point_to_Site_VPN]] â€” P2S VPN for individual clients
> - [[ExpressRoute]] â€” Private connectivity alternative (VPN as backup)
> - [[Virtual_WAN]] â€” VPN in Virtual WAN hub architecture
> - [[VNet_Peering_Routing]] â€” Gateway transit for peered VNets
> - [[Azure_Route_Server]] â€” BGP route exchange with NVAs
> - [[VNet_Subnets_IP_Addressing]] â€” GatewaySubnet requirements

## Table of Contents
- [Overview](#overview)
- [VPN Types: Route-based vs Policy-based](#vpn-types-route-based-vs-policy-based)
- [VPN Gateway SKUs](#vpn-gateway-skus)
- [Connection Types](#connection-types)
- [GatewaySubnet Requirements](#gatewaysubnet-requirements)
- [Local Network Gateway](#local-network-gateway)
- [High Availability Options](#high-availability-options)
- [BGP Configuration](#bgp-configuration)
- [Point-to-Site (P2S) VPN](#point-to-site-p2s-vpn)
- [PowerShell Examples](#powershell-examples)
- [Exam Tips](#exam-tips)

---

## Overview

Azure VPN Gateway is a specific type of virtual network gateway that sends encrypted traffic between an Azure virtual network and on-premises locations over the public Internet. It can also be used to send encrypted traffic between Azure VNets.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Azure VPN Gateway Architecture                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚    On-Premises                    Internet                    Azure          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   VNet        â”‚  â”‚
â”‚   â”‚  Network  â”‚â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ IPSec   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚           â”‚  â”‚           â”‚ Tunnel  â”‚                 â”‚ â”‚GatewaySubnetâ”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚  VPN GW   â”‚ â”‚  â”‚
â”‚        â”‚         â”‚                                       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”‚                                       â”‚       â”‚       â”‚  â”‚
â”‚   â”‚  VPN    â”‚â”€â”€â”€â”€â”˜                                       â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â”‚ Device  â”‚                                            â”‚  â”‚ Workload â”‚  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚  â”‚ Subnets  â”‚  â”‚  â”‚
â”‚                                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   Local Network                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   Gateway (Azure                                                            â”‚
â”‚   representation)                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## VPN Types: Route-based vs Policy-based

### Comparison Table

| Feature | Route-based VPN | Policy-based VPN |
|---------|-----------------|------------------|
| **IKE Version** | IKEv1 and IKEv2 | IKEv1 only |
| **Tunnel Selection** | Any-to-any (wildcard) traffic selectors | Specific address prefixes |
| **Routing** | Uses routing tables | Uses policy/traffic selectors |
| **Multiple Connections** | âœ… Yes (up to 30 S2S) | âŒ Single tunnel only |
| **P2S Support** | âœ… Yes | âŒ No |
| **VNet-to-VNet** | âœ… Yes | âŒ No |
| **Active-Active** | âœ… Yes | âŒ No |
| **BGP Support** | âœ… Yes | âŒ No |
| **Gateway SKUs** | All SKUs | Basic only |
| **Use Case** | Most scenarios | Legacy device compatibility |

### When to Use Each Type

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VPN Type Decision Tree                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Need P2S, VNet-to-VNet, BGP, or Active-Active?                        â”‚
â”‚                    â”‚                                                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚         â”‚                   â”‚                                          â”‚
â”‚        YES                 NO                                          â”‚
â”‚         â”‚                   â”‚                                          â”‚
â”‚         â–¼                   â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Legacy VPN device requiring                        â”‚
â”‚  â”‚ ROUTE-BASED â”‚    policy-based?                                      â”‚
â”‚  â”‚    VPN      â”‚           â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                     â”‚             â”‚                                     â”‚
â”‚                    YES           NO                                     â”‚
â”‚                     â”‚             â”‚                                     â”‚
â”‚                     â–¼             â–¼                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚POLICY-BASED â”‚  â”‚ ROUTE-BASED â”‚                          â”‚
â”‚              â”‚    VPN      â”‚  â”‚    VPN      â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ’¡ **Exam Tip**: Route-based VPN is the default and recommended choice for almost all scenarios. Policy-based is only for legacy compatibility.

---

## VPN Gateway SKUs

### SKU Comparison Table

| SKU | S2S/VNet-to-VNet Tunnels | P2S Connections | Aggregate Throughput | BGP | Zone-Redundant | Price Tier |
|-----|--------------------------|-----------------|----------------------|-----|----------------|------------|
| **Basic** | Max 10 | Max 128 | 100 Mbps | âŒ | âŒ | $ |
| **VpnGw1** | Max 30 | Max 250 | 650 Mbps | âœ… | âŒ | $$ |
| **VpnGw2** | Max 30 | Max 500 | 1 Gbps | âœ… | âŒ | $$$ |
| **VpnGw3** | Max 30 | Max 1000 | 1.25 Gbps | âœ… | âŒ | $$$$ |
| **VpnGw4** | Max 100* | Max 5000 | 5 Gbps | âœ… | âŒ | $$$$$ |
| **VpnGw5** | Max 100* | Max 10000 | 10 Gbps | âœ… | âŒ | $$$$$$ |
| **VpnGw1AZ** | Max 30 | Max 250 | 650 Mbps | âœ… | âœ… | $$ |
| **VpnGw2AZ** | Max 30 | Max 500 | 1 Gbps | âœ… | âœ… | $$$ |
| **VpnGw3AZ** | Max 30 | Max 1000 | 1.25 Gbps | âœ… | âœ… | $$$$ |
| **VpnGw4AZ** | Max 100* | Max 5000 | 5 Gbps | âœ… | âœ… | $$$$$ |
| **VpnGw5AZ** | Max 100* | Max 10000 | 10 Gbps | âœ… | âœ… | $$$$$$ |

*With additional configuration

### SKU Feature Notes

- **Basic SKU**: 
  - Does NOT support BGP
  - Does NOT support IKEv2
  - Does NOT support RADIUS authentication
  - Cannot be resized to other SKUs (must delete and recreate)
  - Legacy SKU - not recommended for production

- **AZ SKUs** (Zone-Redundant):
  - Deploy across Availability Zones
  - Provide 99.95% SLA vs 99.9% for non-AZ
  - Require **Standard** Public IP (not Basic)
  - Require **Static** allocation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SKU Selection Guide                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Throughput Needed?                                                      â”‚
â”‚         â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚      â”‚      â”‚          â”‚          â”‚          â”‚          â”‚            â”‚
â”‚  â–¼      â–¼      â–¼          â–¼          â–¼          â–¼          â–¼            â”‚
â”‚ 100   650    1Gbps     1.25Gbps    5Gbps     10Gbps                     â”‚
â”‚ Mbps  Mbps                                                               â”‚
â”‚  â”‚      â”‚      â”‚          â”‚          â”‚          â”‚                        â”‚
â”‚  â–¼      â–¼      â–¼          â–¼          â–¼          â–¼                        â”‚
â”‚ Basic VpnGw1 VpnGw2    VpnGw3     VpnGw4    VpnGw5                      â”‚
â”‚                                                                          â”‚
â”‚  Need Zone-Redundancy? Add "AZ" suffix (e.g., VpnGw2AZ)                 â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> âš ï¸ **Important**: SKU resizing is supported within the same generation (VpnGw1 â†” VpnGw2 â†” VpnGw3). AZ SKUs can be resized to other AZ SKUs. Cannot resize between AZ and non-AZ SKUs.

---

## Connection Types

### 1. Site-to-Site (S2S) VPN

Connects an on-premises network to an Azure VNet over an IPsec/IKE tunnel.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Site-to-Site VPN Architecture                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   On-Premises                                              Azure         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                â”‚                                  â”‚     VNet       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        IPsec/IKE Tunnel         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Internal â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â”‚ Gateway  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Network  â”‚â”€â”€â”¼â”€â”€â”€â”€â”¤   Public Internet   â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¤  Subnet  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚10.0.0.0/8â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚ VPN GW   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚       â”‚        â”‚                                  â”‚       â”‚        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”‚                                  â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚VPN Deviceâ”‚  â”‚                                  â”‚  â”‚ Workloads â”‚  â”‚  â”‚
â”‚  â”‚  â”‚(Cisco/   â”‚  â”‚                                  â”‚  â”‚10.1.0.0/16â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Juniper) â”‚  â”‚                                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚
â”‚                                                                          â”‚
â”‚  Requirements:                                                           â”‚
â”‚  â€¢ VPN device with public IP                                            â”‚
â”‚  â€¢ Compatible VPN device (IKEv1/IKEv2)                                  â”‚
â”‚  â€¢ Pre-shared key (PSK) or certificate                                  â”‚
â”‚  â€¢ Local Network Gateway in Azure                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**S2S Requirements:**
- On-premises VPN device with a public IPv4 address
- Route-based VPN gateway (recommended)
- Local Network Gateway configured in Azure
- Pre-shared key (PSK) for authentication

### 2. Point-to-Site (P2S) VPN

Connects individual client computers to an Azure VNet.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Point-to-Site VPN Architecture                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Remote Clients                                           Azure         â”‚
â”‚                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚     VNet       â”‚  â”‚
â”‚   â”‚ Laptop  â”‚â”€â”€â”€â”€â”                                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â”‚ (Win10) â”‚    â”‚       VPN over HTTPS/IKEv2       â”‚  â”‚ Gateway  â”‚  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¤  Subnet  â”‚  â”‚  â”‚
â”‚                  â”‚                                   â”‚  â”‚ VPN GW   â”‚  â”‚  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚   â”‚ MacBook â”‚â”€â”€â”€â”€â”¤                                   â”‚       â”‚        â”‚  â”‚
â”‚   â”‚ (macOS) â”‚    â”‚                                   â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                                   â”‚  â”‚ Resources â”‚  â”‚  â”‚
â”‚                  â”‚                                   â”‚  â”‚ VMs, DBs  â”‚  â”‚  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚   â”‚ iPhone/ â”‚â”€â”€â”€â”€â”˜                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â”‚ Android â”‚                                                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚                                                                          â”‚
â”‚   Client receives IP from:                                              â”‚
â”‚   Address Pool (e.g., 172.16.0.0/24)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. VNet-to-VNet Connection

Connects two Azure VNets using VPN gateway to VPN gateway.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VNet-to-VNet Architecture                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Azure Region 1                              Azure Region 2             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚     VNet-A      â”‚                        â”‚     VNet-B      â”‚         â”‚
â”‚  â”‚  10.1.0.0/16    â”‚                        â”‚  10.2.0.0/16    â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    IPsec/IKE Tunnel   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚
â”‚  â”‚  â”‚ Gateway   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ Gateway   â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ Subnet    â”‚â”€â”€â”¼â”€â”€â”€â”¤  VPN-to-VPN   â”œâ”€â”€â”€â”¼â”€â”€â”‚ Subnet    â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ VPN GW-A  â”‚  â”‚   â”‚   Connection  â”‚   â”‚  â”‚ VPN GW-B  â”‚  â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚
â”‚  â”‚       â”‚         â”‚                        â”‚       â”‚         â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”‚                        â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”‚         â”‚
â”‚  â”‚  â”‚Workloadsâ”‚    â”‚                        â”‚  â”‚Workloadsâ”‚    â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                          â”‚
â”‚  Use Cases:                                                              â”‚
â”‚  â€¢ Cross-region connectivity                                            â”‚
â”‚  â€¢ Cross-subscription connectivity                                       â”‚
â”‚  â€¢ When VNet peering not suitable (transit routing needed)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Connection Types Comparison

| Feature | S2S | P2S | VNet-to-VNet |
|---------|-----|-----|--------------|
| **Endpoints** | On-prem â†” Azure | Client â†” Azure | Azure â†” Azure |
| **Protocol** | IPsec/IKE | OpenVPN/SSTP/IKEv2 | IPsec/IKE |
| **On-prem device needed** | âœ… VPN device | âŒ Client software | âŒ No |
| **Max connections** | 30-100 (SKU dependent) | 250-10000 (SKU dependent) | 30-100 |
| **BGP Support** | âœ… Yes | âœ… Yes | âœ… Yes |
| **Encryption** | AES-256 | TLS 1.2+ | AES-256 |

---

## GatewaySubnet Requirements

### Critical Requirements

| Requirement | Details |
|-------------|---------|
| **Name** | MUST be exactly `GatewaySubnet` (case-sensitive) |
| **Minimum Size** | `/27` (32 addresses) - Microsoft recommended |
| **Absolute Minimum** | `/29` (8 addresses) - Not recommended |
| **Recommended Size** | `/27` for most, `/26` for ExpressRoute coexistence |
| **NSG** | âŒ Do NOT attach NSG to GatewaySubnet |
| **UDR** | âš ï¸ Avoid unless absolutely necessary |
| **Delegation** | âŒ Cannot be delegated to other services |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GatewaySubnet Sizing Guide                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   VNet Address Space: 10.0.0.0/16                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                  â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚  Workload Subnet                    10.0.1.0/24          â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                                  â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚  Database Subnet                    10.0.2.0/24          â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                                  â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚  GatewaySubnet (EXACTLY this name!) 10.0.255.0/27        â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â–²                                                        â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â”‚ Reserved for VPN/ExpressRoute Gateway instances       â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â”‚ 32 IPs: 5 reserved by Azure + Gateway instances       â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚   Size Recommendations:                                                  â”‚
â”‚   â€¢ /27 = 32 IPs â†’ VPN Gateway only                                     â”‚
â”‚   â€¢ /26 = 64 IPs â†’ VPN + ExpressRoute coexistence                       â”‚
â”‚   â€¢ /25 = 128 IPs â†’ Future growth with Active-Active                    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> âš ï¸ **Exam Alert**: The GatewaySubnet name is MANDATORY. Azure will not allow you to deploy a VPN Gateway if the subnet has any other name!

---

## Local Network Gateway

The Local Network Gateway is an Azure resource that represents your on-premises VPN device.

### Configuration Requirements

| Parameter | Description | Example |
|-----------|-------------|---------|
| **Name** | Resource name | `lng-onprem-hq` |
| **IP Address** | Public IP of on-prem VPN device | `203.0.113.100` |
| **Address Space** | On-premises network ranges | `10.0.0.0/8`, `172.16.0.0/12` |
| **BGP Settings** | Optional BGP ASN and peer IP | ASN: 65001, BGP Peer: 10.0.0.1 |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Local Network Gateway Concept                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   On-Premises                              Azure                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚   HQ Network    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  10.0.0.0/8     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Local Network Gateway  â”‚   â”‚
â”‚  â”‚                 â”‚   Represents this    â”‚  Name: lng-hq           â”‚   â”‚
â”‚  â”‚  Public IP:     â”‚   on-prem network    â”‚  IP: 203.0.113.100      â”‚   â”‚
â”‚  â”‚  203.0.113.100  â”‚   in Azure           â”‚  Address: 10.0.0.0/8    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                       â”‚                  â”‚
â”‚                                                       â”‚ Connection       â”‚
â”‚                                                       â”‚                  â”‚
â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                                           â”‚    VPN Gateway          â”‚   â”‚
â”‚                                           â”‚    (GatewaySubnet)      â”‚   â”‚
â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚   Multiple LNGs can connect to one VPN Gateway (multi-site VPN)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## High Availability Options

### 1. Active-Standby (Default)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Active-Standby Configuration                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   On-Premises                              Azure VNet                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚             â”‚                        â”‚  GatewaySubnet               â”‚ â”‚
â”‚  â”‚  VPN Device â”‚                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚     â•‘       â”‚    Active Tunnel       â”‚  â”‚ Active  â”‚   â”‚ Standby â”‚  â”‚ â”‚
â”‚  â”‚     â•‘â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â”‚Instance â”‚   â”‚Instance â”‚  â”‚ â”‚
â”‚  â”‚     â•‘       â”‚                        â”‚  â”‚ (PIP-1) â”‚   â”‚(No PIP) â”‚  â”‚ â”‚
â”‚  â”‚             â”‚                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚        â”‚             â”‚      â”‚ â”‚
â”‚                                         â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚                                         â”‚               â”‚             â”‚ â”‚
â”‚                                         â”‚         Single VPN GW       â”‚ â”‚
â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   â€¢ One Public IP                                                        â”‚
â”‚   â€¢ Automatic failover (10-15 seconds for planned, 90s for unplanned)   â”‚
â”‚   â€¢ Connection disruption during failover                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Active-Active Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Active-Active Configuration                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   On-Premises                              Azure VNet                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚             â”‚     Tunnel 1           â”‚  GatewaySubnet               â”‚ â”‚
â”‚  â”‚  VPN Device â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  (2 tunnels)â”‚                        â”‚  â”‚ â”‚ Active  â”‚              â”‚ â”‚
â”‚  â”‚     â•‘       â”‚                        â”‚  â”‚ â”‚Instance1â”‚ PIP-1        â”‚ â”‚
â”‚  â”‚     â•‘       â”‚     Tunnel 2           â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â”‚     â•šâ•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚             â”‚                        â”‚  â”‚ â”‚ Active  â”‚              â”‚ â”‚
â”‚  â”‚             â”‚                        â”‚  â”‚ â”‚Instance2â”‚ PIP-2        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Requirements:                                                          â”‚
â”‚   â€¢ TWO Public IPs (one per instance)                                   â”‚
â”‚   â€¢ VpnGw1 SKU or higher (NOT Basic)                                    â”‚
â”‚   â€¢ Route-based VPN type                                                â”‚
â”‚   â€¢ On-prem device must support multiple tunnels                        â”‚
â”‚   â€¢ BGP recommended for automatic failover                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Zone-Redundant Configuration (AZ SKUs)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Zone-Redundant Configuration                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚                              Azure Region                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                   â”‚  â”‚
â”‚   â”‚     Zone 1              Zone 2              Zone 3               â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚   â”‚   â”‚ Gateway â”‚         â”‚ Gateway â”‚         â”‚ Gateway â”‚           â”‚  â”‚
â”‚   â”‚   â”‚Instance â”‚         â”‚Instance â”‚         â”‚Instance â”‚           â”‚  â”‚
â”‚   â”‚   â”‚  (AZ)   â”‚         â”‚  (AZ)   â”‚         â”‚  (AZ)   â”‚           â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â”‚  â”‚
â”‚   â”‚        â”‚                   â”‚                   â”‚                 â”‚  â”‚
â”‚   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚   â”‚                            â”‚                                     â”‚  â”‚
â”‚   â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                            â”‚  â”‚
â”‚   â”‚                    â”‚ GatewaySubnet â”‚                            â”‚  â”‚
â”‚   â”‚                    â”‚    VNet       â”‚                            â”‚  â”‚
â”‚   â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚  â”‚
â”‚   â”‚                                                                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚   Requirements:                                                          â”‚
â”‚   â€¢ AZ SKUs (VpnGw1AZ, VpnGw2AZ, etc.)                                 â”‚
â”‚   â€¢ Standard SKU Public IP (NOT Basic)                                  â”‚
â”‚   â€¢ Static allocation for Public IP                                     â”‚
â”‚   â€¢ 99.95% SLA (vs 99.9% for non-AZ)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### HA Options Comparison

| Feature | Active-Standby | Active-Active | Zone-Redundant |
|---------|---------------|---------------|----------------|
| **Public IPs** | 1 | 2 | 1 or 2 |
| **Failover Time** | 10-90 seconds | Near-instant | Near-instant |
| **SKU Required** | Any | VpnGw1+ | VpnGw1AZ+ |
| **SLA** | 99.9% | 99.9% | 99.95% |
| **Protects Against** | Instance failure | Instance failure | Zone failure |
| **Additional Cost** | None | 2x gateway | AZ premium |

---

## BGP Configuration

Border Gateway Protocol (BGP) enables dynamic routing between Azure VPN Gateway and on-premises VPN devices.

### Azure BGP Default Settings

| Parameter | Value |
|-----------|-------|
| **Default Azure ASN** | 65515 |
| **Configurable ASN Range** | 1-4294967294 (except 65515) |
| **Reserved ASNs** | 65515 (Azure), 65520 (Azure reserved) |
| **BGP Peer IP** | Automatically assigned from GatewaySubnet |

### BGP Benefits

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BGP vs Static Routing                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   WITHOUT BGP (Static)                 WITH BGP (Dynamic)               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚ Manual route      â”‚               â”‚ Automatic route   â”‚             â”‚
â”‚   â”‚ updates required  â”‚               â”‚ propagation       â”‚             â”‚
â”‚   â”‚                   â”‚               â”‚                   â”‚             â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â” â”‚               â”‚ â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â” â”‚             â”‚
â”‚   â”‚ â”‚On-  â”‚   â”‚Azureâ”‚ â”‚               â”‚ â”‚On-  â”‚â—„â”€â–ºâ”‚Azureâ”‚ â”‚             â”‚
â”‚   â”‚ â”‚Prem â”‚â”€â”€â”€â”‚ VPN â”‚ â”‚               â”‚ â”‚Prem â”‚   â”‚ VPN â”‚ â”‚             â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜ â”‚               â”‚ â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜ â”‚             â”‚
â”‚   â”‚                   â”‚               â”‚   BGP Session     â”‚             â”‚
â”‚   â”‚ Add new subnet:   â”‚               â”‚                   â”‚             â”‚
â”‚   â”‚ Update LNG + VPN  â”‚               â”‚ Add new subnet:   â”‚             â”‚
â”‚   â”‚ device manually   â”‚               â”‚ Auto-propagated!  â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                          â”‚
â”‚   BGP Advantages:                                                        â”‚
â”‚   âœ… Automatic route learning and propagation                           â”‚
â”‚   âœ… Automatic failover in Active-Active setups                         â”‚
â”‚   âœ… Support for multiple paths (ECMP)                                  â”‚
â”‚   âœ… Transit routing between VNets                                      â”‚
â”‚   âœ… Required for Virtual WAN                                           â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### BGP Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BGP Configuration Example                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   On-Premises                              Azure                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚                     â”‚              â”‚                     â”‚           â”‚
â”‚  â”‚  ASN: 65001         â”‚    BGP       â”‚  ASN: 65515         â”‚           â”‚
â”‚  â”‚  BGP Peer: 10.0.0.1 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  BGP Peer: 10.1.0.4 â”‚           â”‚
â”‚  â”‚                     â”‚   Session    â”‚                     â”‚           â”‚
â”‚  â”‚  Routes Advertised: â”‚              â”‚  Routes Advertised: â”‚           â”‚
â”‚  â”‚  - 10.0.0.0/8       â”‚              â”‚  - 10.1.0.0/16      â”‚           â”‚
â”‚  â”‚  - 172.16.0.0/12    â”‚              â”‚  - 10.2.0.0/16      â”‚           â”‚
â”‚  â”‚                     â”‚              â”‚                     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                          â”‚
â”‚   Configuration on Azure VPN Gateway:                                   â”‚
â”‚   - Enable BGP: Yes                                                      â”‚
â”‚   - ASN: 65515 (default) or custom                                      â”‚
â”‚   - BGP Peer IP: Auto-assigned from GatewaySubnet                       â”‚
â”‚                                                                          â”‚
â”‚   Configuration on Local Network Gateway:                               â”‚
â”‚   - BGP Peer IP: On-prem router's BGP IP                                â”‚
â”‚   - ASN: On-prem router's ASN                                           â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ’¡ **Exam Tip**: Remember that Azure's default BGP ASN is **65515**. You can change it, but 65515 and 65520 are reserved for Azure use.

---

## Point-to-Site (P2S) VPN

### Authentication Methods

| Method | Description | Use Case | Requirements |
|--------|-------------|----------|--------------|
| **Azure Certificate** | Client certificates for authentication | Small deployments, testing | PKI infrastructure |
| **Azure AD (Entra ID)** | Azure AD authentication | Enterprise with Azure AD | OpenVPN protocol only |
| **RADIUS** | External RADIUS server | Enterprise with existing RADIUS | RADIUS server, NPS |

### Authentication Methods Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    P2S Authentication Methods                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   1. Azure Certificate Authentication                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    Certificate     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚     â”‚
â”‚   â”‚  â”‚Clientâ”‚â”€â”€â”€â”€â”€â”€Presentedâ”€â”€â”€â”€â–ºâ”‚Azure VPNâ”‚                      â”‚     â”‚
â”‚   â”‚  â”‚ Cert â”‚                    â”‚ Gateway â”‚                      â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚     â”‚
â”‚   â”‚                                                                â”‚     â”‚
â”‚   â”‚  â€¢ Root cert uploaded to Azure                                â”‚     â”‚
â”‚   â”‚  â€¢ Client certs issued from root                              â”‚     â”‚
â”‚   â”‚  â€¢ Self-signed or Enterprise CA                               â”‚     â”‚
â”‚   â”‚  â€¢ Works with all P2S protocols                               â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                          â”‚
â”‚   2. Azure AD (Entra ID) Authentication                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    Azure AD    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚     â”‚
â”‚   â”‚  â”‚Clientâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Entra ID â”‚â”€â”€â”€â–ºâ”‚Azure VPNâ”‚          â”‚     â”‚
â”‚   â”‚  â”‚      â”‚   Auth Token   â”‚          â”‚    â”‚ Gateway â”‚          â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚     â”‚
â”‚   â”‚                                                                â”‚     â”‚
â”‚   â”‚  â€¢ OpenVPN protocol ONLY                                      â”‚     â”‚
â”‚   â”‚  â€¢ Conditional Access supported                               â”‚     â”‚
â”‚   â”‚  â€¢ MFA supported                                              â”‚     â”‚
â”‚   â”‚  â€¢ Azure VPN Client required (Win10+)                         â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                          â”‚
â”‚   3. RADIUS Authentication                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
â”‚   â”‚  â”‚Clientâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚Azure VPNâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ RADIUS â”‚        â”‚     â”‚
â”‚   â”‚  â”‚      â”‚            â”‚ Gateway â”‚            â”‚ Server â”‚        â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜        â”‚     â”‚
â”‚   â”‚                                                  â”‚            â”‚     â”‚
â”‚   â”‚  â€¢ Integrates with existing identity systems    â–¼            â”‚     â”‚
â”‚   â”‚  â€¢ AD, LDAP, OTP supported              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚     â”‚
â”‚   â”‚  â€¢ NPS (Windows) commonly used          â”‚   AD/    â”‚         â”‚     â”‚
â”‚   â”‚  â€¢ On-prem RADIUS must be reachable     â”‚  LDAP    â”‚         â”‚     â”‚
â”‚   â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### P2S Tunnel Protocols

| Protocol | Ports | OS Support | Notes |
|----------|-------|------------|-------|
| **OpenVPN** | TCP 443 / UDP 1194 | Windows, macOS, Linux, iOS, Android | Most flexible, Azure AD support |
| **SSTP** | TCP 443 | Windows only | Proprietary Microsoft, firewall-friendly |
| **IKEv2** | UDP 500, 4500 | Windows, macOS, iOS | Native OS support, fast reconnection |

### Protocol Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    P2S Protocol Selection Guide                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚    OpenVPN      â”‚  â”‚      SSTP       â”‚  â”‚     IKEv2       â”‚        â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚   â”‚ TCP 443         â”‚  â”‚ TCP 443         â”‚  â”‚ UDP 500/4500    â”‚        â”‚
â”‚   â”‚ UDP 1194        â”‚  â”‚                 â”‚  â”‚                 â”‚        â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚   â”‚ âœ… Windows      â”‚  â”‚ âœ… Windows      â”‚  â”‚ âœ… Windows      â”‚        â”‚
â”‚   â”‚ âœ… macOS        â”‚  â”‚ âŒ macOS        â”‚  â”‚ âœ… macOS        â”‚        â”‚
â”‚   â”‚ âœ… Linux        â”‚  â”‚ âŒ Linux        â”‚  â”‚ âŒ Linux        â”‚        â”‚
â”‚   â”‚ âœ… iOS          â”‚  â”‚ âŒ iOS          â”‚  â”‚ âœ… iOS          â”‚        â”‚
â”‚   â”‚ âœ… Android      â”‚  â”‚ âŒ Android      â”‚  â”‚ âŒ Android      â”‚        â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚   â”‚ Azure AD: âœ…    â”‚  â”‚ Azure AD: âŒ    â”‚  â”‚ Azure AD: âŒ    â”‚        â”‚
â”‚   â”‚ Certificate: âœ… â”‚  â”‚ Certificate: âœ… â”‚  â”‚ Certificate: âœ… â”‚        â”‚
â”‚   â”‚ RADIUS: âœ…      â”‚  â”‚ RADIUS: âœ…      â”‚  â”‚ RADIUS: âœ…      â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                          â”‚
â”‚   Recommendations:                                                       â”‚
â”‚   â€¢ Mixed environment (Win/Mac/Linux) â†’ OpenVPN                         â”‚
â”‚   â€¢ Windows only + restrictive firewall â†’ SSTP                          â”‚
â”‚   â€¢ iOS/macOS with fast reconnect needed â†’ IKEv2                        â”‚
â”‚   â€¢ Azure AD authentication required â†’ OpenVPN (ONLY option)            â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> âš ï¸ **Exam Alert**: Azure AD authentication works ONLY with OpenVPN protocol!

---

## PowerShell Examples

### Create VPN Gateway

```powershell
# Variables
$rgName = "rg-vpn-demo"
$location = "uksouth"
$vnetName = "vnet-hub"
$gwSubnetName = "GatewaySubnet"
$gwName = "vpngw-hub"
$gwPipName = "pip-vpngw-hub"

# Create Resource Group
New-AzResourceGroup -Name $rgName -Location $location

# Create VNet with GatewaySubnet
$gwSubnet = New-AzVirtualNetworkSubnetConfig `
    -Name $gwSubnetName `
    -AddressPrefix "10.0.255.0/27"

$workloadSubnet = New-AzVirtualNetworkSubnetConfig `
    -Name "snet-workload" `
    -AddressPrefix "10.0.1.0/24"

$vnet = New-AzVirtualNetwork `
    -Name $vnetName `
    -ResourceGroupName $rgName `
    -Location $location `
    -AddressPrefix "10.0.0.0/16" `
    -Subnet $gwSubnet, $workloadSubnet

# Create Public IP for VPN Gateway (Standard SKU for AZ)
$gwPip = New-AzPublicIpAddress `
    -Name $gwPipName `
    -ResourceGroupName $rgName `
    -Location $location `
    -AllocationMethod Static `
    -Sku Standard

# Get GatewaySubnet reference
$gwSubnetRef = Get-AzVirtualNetworkSubnetConfig `
    -Name $gwSubnetName `
    -VirtualNetwork $vnet

# Create IP Configuration
$gwIpConfig = New-AzVirtualNetworkGatewayIpConfig `
    -Name "gwipconfig" `
    -SubnetId $gwSubnetRef.Id `
    -PublicIpAddressId $gwPip.Id

# Create VPN Gateway (takes 30-45 minutes)
$vpnGw = New-AzVirtualNetworkGateway `
    -Name $gwName `
    -ResourceGroupName $rgName `
    -Location $location `
    -IpConfigurations $gwIpConfig `
    -GatewayType "Vpn" `
    -VpnType "RouteBased" `
    -GatewaySku "VpnGw2AZ" `
    -VpnGatewayGeneration "Generation2"
```

### Create Local Network Gateway

```powershell
# Create Local Network Gateway (represents on-premises)
$lngName = "lng-onprem-hq"
$onpremPublicIP = "203.0.113.100"  # Your on-prem VPN device public IP
$onpremAddressSpaces = @("10.100.0.0/16", "10.200.0.0/16")

$lng = New-AzLocalNetworkGateway `
    -Name $lngName `
    -ResourceGroupName $rgName `
    -Location $location `
    -GatewayIpAddress $onpremPublicIP `
    -AddressPrefix $onpremAddressSpaces
```

### Create S2S Connection

```powershell
# Create Site-to-Site VPN Connection
$connectionName = "conn-to-onprem"
$sharedKey = "YourSecurePreSharedKey123!"  # Use a strong PSK

$connection = New-AzVirtualNetworkGatewayConnection `
    -Name $connectionName `
    -ResourceGroupName $rgName `
    -Location $location `
    -VirtualNetworkGateway1 $vpnGw `
    -LocalNetworkGateway2 $lng `
    -ConnectionType "IPsec" `
    -SharedKey $sharedKey `
    -ConnectionProtocol "IKEv2"
```

### Create Active-Active VPN Gateway

```powershell
# For Active-Active, need two Public IPs
$gwPip1 = New-AzPublicIpAddress `
    -Name "pip-vpngw-1" `
    -ResourceGroupName $rgName `
    -Location $location `
    -AllocationMethod Static `
    -Sku Standard

$gwPip2 = New-AzPublicIpAddress `
    -Name "pip-vpngw-2" `
    -ResourceGroupName $rgName `
    -Location $location `
    -AllocationMethod Static `
    -Sku Standard

# Two IP configurations
$gwIpConfig1 = New-AzVirtualNetworkGatewayIpConfig `
    -Name "gwipconfig1" `
    -SubnetId $gwSubnetRef.Id `
    -PublicIpAddressId $gwPip1.Id

$gwIpConfig2 = New-AzVirtualNetworkGatewayIpConfig `
    -Name "gwipconfig2" `
    -SubnetId $gwSubnetRef.Id `
    -PublicIpAddressId $gwPip2.Id

# Create Active-Active Gateway
$vpnGwAA = New-AzVirtualNetworkGateway `
    -Name "vpngw-active-active" `
    -ResourceGroupName $rgName `
    -Location $location `
    -IpConfigurations @($gwIpConfig1, $gwIpConfig2) `
    -GatewayType "Vpn" `
    -VpnType "RouteBased" `
    -GatewaySku "VpnGw2AZ" `
    -EnableActiveActiveFeature `
    -VpnGatewayGeneration "Generation2"
```

### Configure BGP

```powershell
# Create VPN Gateway with BGP
$vpnGwBgp = New-AzVirtualNetworkGateway `
    -Name "vpngw-bgp" `
    -ResourceGroupName $rgName `
    -Location $location `
    -IpConfigurations $gwIpConfig `
    -GatewayType "Vpn" `
    -VpnType "RouteBased" `
    -GatewaySku "VpnGw2AZ" `
    -Asn 65515 `
    -EnableBgp $true

# Create Local Network Gateway with BGP
$lngBgp = New-AzLocalNetworkGateway `
    -Name "lng-onprem-bgp" `
    -ResourceGroupName $rgName `
    -Location $location `
    -GatewayIpAddress $onpremPublicIP `
    -AddressPrefix @() `  # Empty when using BGP
    -Asn 65001 `
    -BgpPeeringAddress "10.100.0.1"  # On-prem BGP peer IP
```

### Configure P2S VPN

```powershell
# Configure P2S with Certificate Authentication
$vpnClientAddressPool = "172.16.0.0/24"

# Get root certificate (Base64 encoded, without header/footer)
$rootCertData = "MIIDYTCCAkmgAwIBAgIJAMHsss..."  # Your root cert

$p2sRootCert = New-AzVpnClientRootCertificate `
    -Name "P2SRootCert" `
    -PublicCertData $rootCertData

# Update existing gateway with P2S config
Set-AzVirtualNetworkGateway `
    -VirtualNetworkGateway $vpnGw `
    -VpnClientAddressPool $vpnClientAddressPool `
    -VpnClientProtocol @("OpenVPN", "IkeV2") `
    -VpnClientRootCertificates $p2sRootCert

# Download VPN client configuration
$vpnClientConfig = New-AzVpnClientConfiguration `
    -ResourceGroupName $rgName `
    -Name $gwName `
    -AuthenticationMethod "EapTls"

# Output the download URL
$vpnClientConfig.VPNProfileSASUrl
```

### Check Connection Status

```powershell
# Get VPN Connection status
Get-AzVirtualNetworkGatewayConnection `
    -Name $connectionName `
    -ResourceGroupName $rgName | 
    Select-Object Name, ConnectionStatus, EgressBytesTransferred, IngressBytesTransferred

# Get detailed connection info
Get-AzVirtualNetworkGatewayConnectionSharedKey `
    -Name $connectionName `
    -ResourceGroupName $rgName

# Reset VPN Gateway (if troubleshooting)
Reset-AzVirtualNetworkGateway `
    -VirtualNetworkGateway $vpnGw
```

---

## Exam Tips

### VPN Gateway vs ExpressRoute Decision Matrix

| Requirement | VPN Gateway | ExpressRoute |
| --- | --- | --- |
| **Max Bandwidth** | 10 Gbps | 100 Gbps |
| **Connection** | Public Internet | Private (no Internet) |
| **Latency** | Variable | Consistent, low |
| **Setup Time** | Minutes | Days/weeks |
| **Cost** | Lower | Higher |
| **Use Case** | Dev/test, small production, P2S | Mission-critical, large data transfer |
| **Encryption** | IPsec built-in | Optional (MACsec Direct) |

### Quick Decision Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               HYBRID CONNECTIVITY DECISION TREE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Need private dedicated connection (no Internet)?                       â”‚
â”‚                    â”‚                                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚        YES                 NO                                            â”‚
â”‚         â”‚                   â”‚                                            â”‚
â”‚         â–¼                   â–¼                                            â”‚
â”‚    ExpressRoute        Need > 10 Gbps?                                  â”‚
â”‚                             â”‚                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                   YES               NO                                   â”‚
â”‚                    â”‚                 â”‚                                   â”‚
â”‚                    â–¼                 â–¼                                   â”‚
â”‚             ExpressRoute     Individual users (P2S)?                    â”‚
â”‚              Direct               â”‚                                      â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         YES               NO                             â”‚
â”‚                          â”‚                 â”‚                             â”‚
â”‚                          â–¼                 â–¼                             â”‚
â”‚                     P2S VPN          S2S VPN                            â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Points to Remember

| Topic | Key Points |
|-------|------------|
| **VPN Types** | Route-based is default and recommended; Policy-based only for legacy |
| **GatewaySubnet** | Name must be EXACTLY "GatewaySubnet"; minimum /27; NO NSG |
| **SKUs** | Basic doesn't support BGP/IKEv2; AZ SKUs need Standard PIP |
| **BGP ASN** | Default is 65515; 65520 also reserved for Azure |
| **P2S + Azure AD** | OpenVPN protocol ONLY |
| **Active-Active** | Requires 2 PIPs; VpnGw1+ SKU; Route-based only |
| **Zone-Redundant** | AZ SKUs only; Standard PIP required; 99.95% SLA |

### Gotchas That Appear on Exams

1. **GatewaySubnet name is CASE-SENSITIVE** - Must be exactly "GatewaySubnet"
2. **Basic SKU cannot resize** - Delete and recreate required
3. **P2S with Azure AD = OpenVPN only** - SSTP/IKEv2 don't support Azure AD
4. **Active-Active needs 2 public IPs** - One per gateway instance
5. **Policy-based VPN = 1 tunnel only** - No multi-site, no P2S
6. **BGP ASN 65515 is Azure's** - Don't use on-premises
7. **No NSG on GatewaySubnet** - Will break the gateway

### Common Exam Scenarios

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Common Exam Scenarios                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Q: "Customer needs P2S VPN with Azure AD auth for Mac users"          â”‚
â”‚   A: OpenVPN protocol (only option for Azure AD)                        â”‚
â”‚                                                                          â”‚
â”‚   Q: "Need highest availability for VPN Gateway"                        â”‚
â”‚   A: Active-Active with Zone-Redundant (VpnGw*AZ SKU)                  â”‚
â”‚                                                                          â”‚
â”‚   Q: "VPN Gateway deployment fails - subnet named 'VPNSubnet'"          â”‚
â”‚   A: Must be named exactly "GatewaySubnet"                              â”‚
â”‚                                                                          â”‚
â”‚   Q: "Customer has old Cisco device only supporting IKEv1"              â”‚
â”‚   A: Policy-based VPN (but note limitations)                            â”‚
â”‚                                                                          â”‚
â”‚   Q: "Need automatic route updates between Azure and on-prem"           â”‚
â”‚   A: Enable BGP on both VPN Gateway and Local Network Gateway           â”‚
â”‚                                                                          â”‚
â”‚   Q: "P2S VPN client address pool?"                                     â”‚
â”‚   A: Must not overlap with VNet or on-prem ranges                       â”‚
â”‚                                                                          â”‚
â”‚   Q: "Maximum throughput needed for VPN"                                â”‚
â”‚   A: VpnGw5/VpnGw5AZ = 10 Gbps                                         â”‚
â”‚                                                                          â”‚
â”‚   Q: "Resize Basic SKU to VpnGw2"                                       â”‚
â”‚   A: Cannot resize Basic - must delete and recreate                     â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quick Reference Commands

```powershell
# List all VPN Gateways
Get-AzVirtualNetworkGateway -ResourceGroupName $rgName

# Get VPN Gateway BGP settings
Get-AzVirtualNetworkGateway -Name $gwName -ResourceGroupName $rgName | 
    Select-Object -ExpandProperty BgpSettings

# List all connections
Get-AzVirtualNetworkGatewayConnection -ResourceGroupName $rgName

# Get P2S VPN clients
Get-AzVirtualNetworkGateway -Name $gwName -ResourceGroupName $rgName |
    Get-AzVirtualNetworkGatewayVpnClientConnectionHealth

# Verify Gateway Subnet
Get-AzVirtualNetworkSubnetConfig -Name "GatewaySubnet" -VirtualNetwork $vnet
```

### Troubleshooting Checklist

- [ ] GatewaySubnet named correctly and sized appropriately (/27+)
- [ ] Public IP is Static (Standard SKU for AZ)
- [ ] No NSG on GatewaySubnet
- [ ] Pre-shared keys match on both ends (S2S)
- [ ] On-prem VPN device is compatible
- [ ] Address spaces don't overlap
- [ ] P2S client address pool doesn't overlap with VNet ranges
- [ ] Correct protocol selected for authentication method
- [ ] BGP ASNs are unique (not using reserved 65515/65520 on-prem)

---

## Azure Extended Network (Subnet Stretching)

> **Exam Relevance**: The AZ-700 study guide mentions "Azure Extended Network" under connectivity services. This feature stretches an on-premises Layer 2 subnet into Azure over a VXLAN tunnel.

### What Is Azure Extended Network?

Azure Extended Network allows you to **stretch an on-premises subnet to Azure** so that on-premises virtual machines can keep their original private IP addresses when moved to Azure. It uses a **VXLAN tunnel** between two Windows Server VMs acting as appliances.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ON-PREMISES                â”‚       â”‚              AZURE                   â”‚
â”‚                                     â”‚       â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   VM with  â”‚   â”‚  Extended   â”‚  â”‚  S2S  â”‚  â”‚  Extended   â”‚   â”‚   VM with   â”‚  â”‚
â”‚  â”‚ original IPâ”‚â”€â”€â–¶â”‚  Network    â”‚â”€â”€â”‚â”€â”€VPNâ”€â”€â”‚â”€â”€â”‚  Network    â”‚â”€â”€â–¶â”‚ same IP in  â”‚  â”‚
â”‚  â”‚ 10.1.1.5   â”‚   â”‚  Agent (WS) â”‚  â”‚  or   â”‚  â”‚  Agent (WS) â”‚   â”‚ Azure VNet  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  ER   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚       â”‚                                      â”‚
â”‚  Subnet: 10.1.1.0/24              â”‚       â”‚  Extended Subnet: 10.1.1.0/24       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Characteristics

| Property | Detail |
|----------|--------|
| **Tunnel Protocol** | VXLAN (UDP 4789) |
| **Appliance OS** | Windows Server 2019 or 2022 |
| **Max IP Addresses** | **250** per extended subnet |
| **Throughput** | ~700 Mbps |
| **Backbone** | Requires **Site-to-Site VPN** or **ExpressRoute** already configured |
| **Management** | Windows Admin Center (WAC) â€” `msft.sme.subnet-stretch` extension |
| **Use Case** | Gradual migration â€” VMs keep IPs during lift-and-shift |
| **Layer** | Layer 2 (MAC-level stretch) |

### Prerequisites

1. **Two Windows Server 2019/2022 VMs** â€” one on-prem, one in Azure
2. **Site-to-Site VPN or ExpressRoute** â€” already established connectivity
3. **Windows Admin Center** â€” installed and connected to Azure
4. **Azure VNet** â€” with a subnet matching the on-prem subnet range
5. Both agent VMs need **4 GB RAM minimum** and **Windows Server Datacenter edition**

### Configuration via Windows Admin Center

```powershell
# Step 1: Install the Azure Extended Network extension in WAC
# Navigate to: WAC > Settings > Extensions > install "Azure Extended Network"

# Step 2: On the on-prem server registered in WAC:
# Navigate to: Azure Extended Network > Set Up
# Select the subnet to extend (e.g., 10.1.1.0/24)
# Provide the Azure VM agent details

# Step 3: WAC deploys VXLAN tunnel between the two agents
# Traffic flow: On-prem VM â†’ VXLAN encap â†’ S2S/ER â†’ VXLAN decap â†’ Azure VM
```

### Exam Tips â€” Extended Network

> [!warning] Critical Exam Points
> 1. **250 IP address limit** â€” Cannot extend subnets with more than 250 IPs
> 2. **Requires existing S2S VPN or ExpressRoute** â€” It's NOT a standalone connectivity solution
> 3. **Windows Server only** â€” Both agent VMs must be Windows Server 2019/2022 Datacenter
> 4. **Not for production long-term** â€” Designed for migration scenarios, not permanent architecture
> 5. **VXLAN encapsulation overhead** â€” ~700 Mbps throughput ceiling
> 6. **No Linux support** â€” Agent VMs must be Windows

### Comparison: Extended Network vs Other Migration Tools

| Feature | Azure Extended Network | Azure Migrate | Azure Site Recovery |
|---------|----------------------|---------------|---------------------|
| **IP Preservation** | âœ… Same L2 subnet | âŒ New IP assignment | âŒ New IP at failover |
| **Downtime** | Minimal (live migration) | Depends on method | Brief (failover) |
| **Max Scale** | 250 IPs per subnet | Thousands of VMs | Thousands of VMs |
| **Use Case** | Gradual subnet migration | Full datacenter migration | DR / migration |
| **Prerequisites** | S2S/ER + WAC + WS2019 | Appliance on-prem | Replication agent |

---

## Draw.io Diagrams

Save as `.drawio` file and open in VS Code with Draw.io extension:

### Site-to-Site VPN Architecture

```xml
<mxfile host="app.diagrams.net">
  <diagram name="S2S VPN" id="s2s-vpn-arch">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="onprem" value="On-Premises&#xa;192.168.0.0/16" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="80" y="160" width="140" height="80" as="geometry" />
        </mxCell>
        <mxCell id="vpndevice" value="VPN Device&#xa;(Cisco, Fortinet, etc.)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="280" y="160" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="internet" value="Internet&#xa;IPsec Tunnel" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="440" y="150" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="vpngw" value="VPN Gateway&#xa;GatewaySubnet&#xa;10.0.255.0/27" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="600" y="150" width="140" height="80" as="geometry" />
        </mxCell>
        <mxCell id="vnet" value="Azure VNet&#xa;10.0.0.0/16" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="800" y="160" width="140" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lng" value="Local Network&#xa;Gateway&#xa;(On-prem rep.)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="600" y="280" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="e1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" parent="1" source="onprem" target="vpndevice">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" parent="1" source="vpndevice" target="internet">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" parent="1" source="internet" target="vpngw">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" parent="1" source="vpngw" target="vnet">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;dashed=1;" edge="1" parent="1" source="vpngw" target="lng">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
```

### Point-to-Site VPN Architecture

```xml
<mxfile host="app.diagrams.net">
  <diagram name="P2S VPN" id="p2s-vpn-arch">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="user1" value="Remote User 1&#xa;(Windows)" style="shape=actor;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="100" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="user2" value="Remote User 2&#xa;(macOS)" style="shape=actor;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="220" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="user3" value="Remote User 3&#xa;(Linux)" style="shape=actor;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="340" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="internet" value="Internet&#xa;OpenVPN/IKEv2/SSTP" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="280" y="180" width="160" height="100" as="geometry" />
        </mxCell>
        <mxCell id="vpngw" value="VPN Gateway&#xa;P2S Configuration&#xa;&#xa;Auth: Cert/RADIUS/&#xa;Microsoft Entra ID" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="520" y="160" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="vnet" value="Azure VNet&#xa;10.0.0.0/16&#xa;&#xa;VMs, App Services,&#xa;Databases" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="760" y="160" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="pool" value="Client Pool:&#xa;172.16.0.0/24" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="520" y="320" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="e1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" parent="1" source="user1" target="internet">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" parent="1" source="user2" target="internet">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" parent="1" source="user3" target="internet">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" parent="1" source="internet" target="vpngw">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" parent="1" source="vpngw" target="vnet">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;dashed=1;" edge="1" parent="1" source="vpngw" target="pool">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
```

### Active-Active VPN Gateway

```xml
<mxfile host="app.diagrams.net">
  <diagram name="Active-Active VPN" id="aa-vpn-arch">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="onprem" value="On-Premises&#xa;2 VPN Devices" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="80" y="180" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="vpngw" value="VPN Gateway&#xa;(Active-Active)&#xa;&#xa;Instance 1: PIP1&#xa;Instance 2: PIP2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="400" y="160" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="vnet" value="Azure VNet" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="640" y="180" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="tunnel1" value="Tunnel 1" style="text;html=1;strokeColor=none;fillColor=none;align=center;" vertex="1" parent="1">
          <mxGeometry x="260" y="160" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tunnel2" value="Tunnel 2" style="text;html=1;strokeColor=none;fillColor=none;align=center;" vertex="1" parent="1">
          <mxGeometry x="260" y="260" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="e1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#00CC00;strokeWidth=2;" edge="1" parent="1" source="onprem" target="vpngw">
          <mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="300" y="180" /><mxPoint x="300" y="190" /></Array></mxGeometry>
        </mxCell>
        <mxCell id="e2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#00CC00;strokeWidth=2;" edge="1" parent="1" source="onprem" target="vpngw">
          <mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="300" y="260" /><mxPoint x="300" y="250" /></Array></mxGeometry>
        </mxCell>
        <mxCell id="e3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" parent="1" source="vpngw" target="vnet">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
```

---

## Additional Resources

- [Microsoft Learn: VPN Gateway Documentation](https://learn.microsoft.com/azure/vpn-gateway/)
- [VPN Gateway FAQ](https://learn.microsoft.com/azure/vpn-gateway/vpn-gateway-vpn-faq)
- [Validated VPN Devices](https://learn.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpn-devices)
- [BGP with VPN Gateway](https://learn.microsoft.com/azure/vpn-gateway/vpn-gateway-bgp-overview)
- [P2S Configuration](https://learn.microsoft.com/azure/vpn-gateway/point-to-site-about)
